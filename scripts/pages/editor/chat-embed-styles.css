/* ===========================================================
   CHAT / MESSAGES — Harmonisé avec tes variables globales
   (aucune redéfinition de --color--* ici)
   =========================================================== */

/* Conteneur */
#chatView{
  display:flex;
  flex-direction:column;
  gap: .9rem;
  padding: .25rem 0;
  overflow:auto;
}

/* Bouton occupé */
#btnAsk.is-busy{ opacity:.65; pointer-events:none; }

/* Message (conteneur) */
.msg{
  display:flex;
  flex-direction:column;
  max-width:72ch;
  animation: chat-slide-in .28s ease-out;
}
.msg--user{ align-self:flex-end; }
.msg--ai{   align-self:flex-start; }
.msg--sys{  align-self:center; opacity:.85; }

/* Petite meta (auteur/heure) */
.msg-meta{
  font:600 .72rem/1.2 system-ui,-apple-system,Segoe UI,Roboto;
  color: var(--agilo-dim, var(--color--gris, #525252));
  margin: 0 0 .35rem;
}

/* Bulle */
.msg-bubble{
  padding: .85rem 1rem;
  border-radius: var(--0-5_radius, .5rem);
  background: var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa));
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  border: 1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
  box-shadow: var(--agilo-shadow, 0 1px 2px rgba(0,0,0,.08), 0 4px 10px rgba(0,0,0,.06));
  white-space: normal;
  line-height: 1.6;
}

/* Bulle “user” en primaire (contraste AA) */
.msg--user .msg-bubble{
  background: var(--agilo-primary, var(--color--blue, #174a96));
  color: var(--color--white, #fff);
  border-color: transparent;
}

/* ===== BLOC EMAIL (type ChatGPT) ===== */
.msg-bubble--email {
  padding: 0;
  overflow: hidden;
  max-width: 100%;
}

.agilo-email-block {
  width: 100%;
  border-radius: var(--0-5_radius, .5rem);
  background: var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa));
  border: 1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
  box-shadow: 0 1px 3px rgba(0,0,0,.07), 0 4px 12px rgba(0,0,0,.05);
  overflow: hidden;
}

.agilo-email-block-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: .5rem;
  padding: .5rem .75rem;
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 4%, var(--agilo-surface-2, #f8f9fa));
  border-bottom: 1px solid var(--agilo-border, #343a4040);
  flex-wrap: wrap;
}

.agilo-email-block-label {
  font: 600 .8rem/1.2 system-ui, -apple-system, Segoe UI, Roboto;
  color: var(--agilo-dim, var(--color--gris, #525252));
}

.agilo-email-block-tools {
  display: flex;
  align-items: center;
  gap: .25rem;
}

/* Boutons icon-only style ChatGPT (Copy + Open in app) */
.agilo-email-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .25rem;
  width: 2rem;
  height: 2rem;
  padding: 0;
  border: none;
  border-radius: .375rem;
  background: transparent;
  color: var(--agilo-dim, var(--color--gris, #6b7280));
  cursor: pointer;
  text-decoration: none;
  transition: color .15s, background .15s, transform .15s;
}

.agilo-email-btn:hover {
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 6%, transparent);
}

.agilo-email-btn:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--agilo-primary) 60%, transparent);
  outline-offset: 2px;
}

.agilo-email-btn .agilo-email-icon {
  flex-shrink: 0;
}

/* Bouton "Open in app" + dropdown (style ChatGPT) */
.agilo-email-open-wrap {
  position: relative;
  display: inline-flex;
}

.agilo-email-btn-open .agilo-email-icon,
.agilo-email-btn-open .agilo-email-send-icon {
  color: var(--agilo-dim, #6b7280);
}

.agilo-email-btn-open:hover .agilo-email-icon,
.agilo-email-btn-open:hover .agilo-email-send-icon {
  color: var(--agilo-text, #020202);
}

.agilo-email-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  min-width: 180px;
  padding: 6px;
  border-radius: 8px;
  background: var(--agilo-surface, var(--color--white, #fff));
  border: 1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  z-index: 100;
  list-style: none;
}

.agilo-email-dropdown[hidden] {
  display: none;
}

.agilo-email-dropdown-item {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 8px 10px;
  border: none;
  border-radius: 6px;
  background: transparent;
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  font: 500 .8125rem/1.3 system-ui, -apple-system, Segoe UI, Roboto;
  text-decoration: none;
  cursor: pointer;
  transition: background .12s;
  text-align: left;
}

.agilo-email-dropdown-item:hover {
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 6%, var(--agilo-surface-2, #f8f9fa));
  color: var(--agilo-text, #020202);
}

.agilo-email-dropdown-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

.agilo-email-dropdown-icon svg,
.agilo-email-dropdown-icon img {
  width: 20px;
  height: 20px;
  display: block;
  object-fit: contain;
}

.agilo-email-dropdown-icon .agilo-email-logo-default {
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
}

.agilo-email-btn-copy.agilo-email-btn-copied {
  color: var(--agilo-text, #020202);
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 8%, transparent);
  transform: scale(1.05);
}

.agilo-email-block-subject {
  padding: .5rem .75rem;
  font: 600 .85rem/1.3 system-ui, -apple-system, Segoe UI, Roboto;
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  border-bottom: 1px solid var(--agilo-border, #343a4040);
}

.agilo-email-block-subject-label {
  color: var(--agilo-dim, var(--color--gris, #525252));
  font-weight: 500;
  margin-right: .35rem;
}

.agilo-email-block-body {
  padding: .75rem 1rem;
  font-size: .9rem;
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  word-break: break-word;
  line-height: 1.6;
  max-height: 50vh;
  overflow-y: auto;
}

.agilo-email-block-body .agilo-email-p {
  margin: 0 0 .9em;
}

.agilo-email-block-body .agilo-email-p:last-child {
  margin-bottom: 0;
}

.agilo-email-block-body .agilo-email-p-first {
  font-weight: 600;
  color: var(--agilo-text, #020202);
}

/* Bloc "Ci-dessous" (commentaire interne) */
.agilo-email-internal-comment {
  margin-top: 0;
  padding: .6rem 1rem .75rem;
  border-top: 1px solid var(--agilo-border, #343a4040);
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 3%, var(--agilo-surface-2, #f8f9fa));
}

.agilo-email-ci-dessous {
  display: flex;
  align-items: center;
  gap: .4rem;
  font: 600 .75rem/1.2 system-ui, -apple-system, Segoe UI, Roboto;
  color: var(--agilo-dim, var(--color--gris, #525252));
  margin-bottom: .35rem;
}

.agilo-email-ci-dessous svg {
  flex-shrink: 0;
  color: var(--agilo-dim, #525252);
}

.agilo-email-internal-comment-text {
  font-size: .85rem;
  line-height: 1.5;
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
}

/* Typo/rendu Markdown générique (sans wrapper .prose) */
.msg-bubble h1,.msg-bubble h2,.msg-bubble h3{
  margin:.8em 0 .4em; font-weight:700; line-height:1.3;
}
.msg-bubble h1{ font-size:1.5em; }
.msg-bubble h2{ font-size:1.25em; }
.msg-bubble h3{ font-size:1.05em; }
.msg-bubble p{ margin:.45em 0; }
.msg-bubble ul,.msg-bubble ol{ margin:.35em 0 .6em 1.25em; padding:0; }
.msg-bubble li{ margin:.15em 0; }
.msg-bubble hr{
  border:0; margin:.6em 0;
  border-top:1px solid var(--agilo-divider, color-mix(in srgb, var(--agilo-text, #0b1222) 14%, transparent));
}
.msg-bubble a{
  color: var(--agilo-primary, var(--color--blue, #174a96));
  text-decoration: underline;
}
.msg-bubble blockquote{
  margin:.6em 0; padding:.45em .8em; border-radius:.35rem;
  border-left:3px solid var(--agilo-primary, var(--color--blue, #174a96));
  background: color-mix(in srgb,
              var(--agilo-primary, var(--color--blue, #174a96)) 6%,
              var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa)));
}
.msg-bubble code{
  font-family: ui-monospace, Menlo, monospace;
  background: color-mix(in srgb,
              var(--agilo-text, var(--color--gris_foncé, #020202)) 8%,
              var(--agilo-surface, var(--color--white, #fff)));
  padding:.05em .35em; border-radius:.3em;
}
.msg-bubble pre{
  background: color-mix(in srgb,
              var(--agilo-text, var(--color--gris_foncé, #020202)) 92%,
              var(--agilo-surface, var(--color--white, #fff)));
  color: var(--color--white, #fff);
  padding:.7em .85em; border-radius: var(--0-5_radius, .5rem);
  overflow:auto;
}
.msg-bubble pre code{ background:transparent; padding:0; }

/* Barre d'actions sous la bulle (copier, export…) */
.msg-actions,
.msg-tools{
  display:flex;
  flex-wrap:wrap;
  gap:.4rem;
  margin:.45rem 0 0;
  padding-top:.55rem;
  border-top:1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
}
.msg-action-btn{
  appearance:none;
  cursor:pointer;
  user-select:none;
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  border:1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
  background: var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa));
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  padding:.36rem .6rem;
  border-radius:.45rem;
  font:600 .78rem/1 system-ui,-apple-system,Segoe UI,Roboto;
  transition: background .15s, transform .06s, color .15s, border-color .15s;
}
.msg-action-btn:hover{
  background: color-mix(in srgb,
              var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa)) 70%,
              var(--agilo-primary, var(--color--blue, #174a96)) 30%);
  color: var(--color--white, #fff);
  border-color: transparent;
}
.msg-action-btn:active{ transform: translateY(.0625rem); }
.msg-action-btn:focus-visible{
  outline: var(--agilo-focus, 2px solid color-mix(in srgb, var(--agilo-primary) 70%, transparent));
  outline-offset: 2px;
}
.msg-action-btn[disabled]{ opacity:.6; cursor:not-allowed; }

.msg-action-copy-copied {
  background: color-mix(in srgb, var(--agilo-text, #0b1222) 8%, var(--agilo-surface-2, #f8f9fa)) !important;
  color: var(--agilo-text, #020202) !important;
  border-color: var(--agilo-border, rgba(0,0,0,.15)) !important;
}

/* Titres manquants (tu n'as que h1–h3 aujourd'hui) */
.msg-bubble h4,.msg-bubble h5,.msg-bubble h6{
  margin:.65em 0 .35em; font-weight:700; line-height:1.3;
}
.msg-bubble h4{ font-size:1.0em; }
.msg-bubble h5{ font-size:.95em; }
.msg-bubble h6{ font-size:.9em; }

/* Tables Markdown (rend .md-table propre sans toucher le reste) */
.msg-bubble table.md-table{
  width:100%; border-collapse:collapse;
  margin:.55em 0 .85em; font-size:.95em;
  border:1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
}
.msg-bubble .md-table th,
.msg-bubble .md-table td{
  padding:.45em .6em; vertical-align:top;
  border:1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
}
.msg-bubble .md-table thead th{
  background: color-mix(in srgb,
              var(--agilo-primary, var(--color--blue, #174a96)) 6%,
              var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa)));
  font-weight:700;
}
.msg-bubble .md-table tbody tr:nth-child(odd){
  background: color-mix(in srgb,
              var(--agilo-text, var(--color--gris_foncé, #020202)) 3%,
              var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa)));
}

/* Sous-listes un peu plus compactes (complément, ne remplace rien) */
.msg-bubble ul ul,
.msg-bubble ol ol{ margin:.25em 0 .5em 1.25em; }

/* Cases à cocher dans les listes */
.msg-bubble li input[type="checkbox"]{
  margin-right:.35em; transform:translateY(2px);
}

/* (Optionnel) Boutons timecode que tu insères dans le HTML */
.msg-bubble .agilo-tc{
  display:inline-flex; align-items:center; gap:.25rem;
  border:1px solid var(--agilo-border, var(--color--noir_25, #343a4040));
  background: var(--agilo-surface-2, var(--color--blanc_gris, #f8f9fa));
  color: var(--agilo-text, var(--color--gris_foncé, #020202));
  padding:.08rem .35rem; border-radius:.35rem;
  font:600 .78rem/1 system-ui,-apple-system,Segoe UI,Roboto; cursor:pointer;
}
.msg-bubble .agilo-tc:hover{
  background: color-mix(in srgb,
              var(--agilo-surface-2, #f8f9fa) 70%,
              var(--agilo-primary, #174a96) 30%);
  color:#fff; border-color:transparent;
}
/* Sous-listes rendues comme imbriquées même si le HTML est "à plat" */
.msg-bubble li + ul,
.msg-bubble li + ol{
  margin-top:.25em;
  margin-bottom:.5em;
  margin-left:1.25em;
}

/* Citations : micro-rythme du texte interne */
.msg-bubble blockquote p{ margin:.25em 0; }

/* ===== INDICATEUR "THINKING" CHATGPT-STYLE ===== */
.thinking-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: var(--color--gris, #6b7280);
  font-weight: 500;
  font-size: 14px;
}

.thinking-dots {
  display: inline-flex;
  gap: 4px;
}

.thinking-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--color--gris, #6b7280);
  animation: thinking-pulse 1.4s ease-in-out infinite;
}

.thinking-dot:nth-child(1) { animation-delay: 0s; }
.thinking-dot:nth-child(2) { animation-delay: 0.2s; }
.thinking-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes thinking-pulse {
  0%, 60%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  30% {
    opacity: 1;
    transform: scale(1);
  }
}

/* Animation d'apparition */
.thinking-indicator {
  animation: thinking-fade-in 0.3s ease-out;
}

@keyframes thinking-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Petite animation d'arrivée */
@keyframes chat-slide-in{
  from{ opacity:0; transform:translateY(10px); }
  to{   opacity:1; transform:translateY(0); }
}

/* Responsive */
@media (max-width: 40rem){
  #chatView{ gap: .7rem; }
  .msg-bubble{ padding:.75rem .85rem; }
  .msg-bubble--email { padding: 0; }
  .msg-actions .msg-action-btn{ font-size:.74rem; }
  .agilo-email-block-header { padding: .45rem .6rem; }
  .agilo-email-block-body { padding: .6rem .75rem; max-height: 40vh; }
}

/* Respecte "réduire les animations" */
@media (prefers-reduced-motion: reduce){
  *{ animation-duration:.001ms !important; animation-iteration-count:1 !important; transition:none !important; }
}
