<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Anonymisation - Agiloshield</title>
  <link rel="stylesheet" href="agiloshield-embed-anonymisation.css">
</head>
<body>

<form id="agfForm" ms-code-anonymisation="form" novalidate>
  <input type="hidden" name="memberEmail" data-ms-member-email="" ms-code-member-email>

  <section class="agf-shell" aria-label="Anonymisation avancée">
    <header class="agf-head">
      <h2>Anonymisation documentaire</h2>
      <p>Flux unifié pour fichiers, texte et restauration avec gouvernance de sécurité.</p>
    </header>

    <div class="agf-tabs" role="tablist" aria-label="Modes de traitement">
      <button id="agfTab-file" class="agf-tab" type="button" role="tab" aria-selected="true" aria-controls="agfPanel-file" data-tab="file">
        <strong>Traitement de fichier</strong>
        <span>PDF, Image, CSV, FEC, etc.</span>
      </button>
      <button id="agfTab-text" class="agf-tab" type="button" role="tab" aria-selected="false" aria-controls="agfPanel-text" data-tab="text">
        <strong>Traitement de texte</strong>
        <span>Email, Markdown, etc.</span>
      </button>
      <button id="agfTab-restore" class="agf-tab" type="button" role="tab" aria-selected="false" aria-controls="agfPanel-restore" data-tab="restore">
        <strong>Restauration</strong>
        <span>Restaurez les données pseudonymisées</span>
      </button>
    </div>

    <div class="agf-grid">
      <div class="agf-main">
        <section id="agfPanel-file" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-file" aria-hidden="false">
          <h3 class="agf-section-title">Sélectionnez les fichiers</h3>
          <div id="agfDropzone" class="agf-dropzone" role="button" tabindex="0" aria-label="Zone de dépôt fichiers">
            <h4>Cliquez ou glissez-déposez des fichiers</h4>
            <p>PDF, Word, Excel, images et autres formats courants (10 Mo max / fichier).</p>
            <p class="agf-formats-explicit">Formats pris en charge : CSV, Word (doc, docx), PowerPoint (ppt, pptx), Excel (xls, xlsx), TXT.</p>
          </div>
          <input id="agfFileInput" type="file" name="fileUpload[]" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.json,.fec,.png,.jpg,.jpeg,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/csv,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,application/json,image/png,image/jpeg">

          <h3 class="agf-section-title">Fichiers à anonymiser</h3>
          <div id="agfFileList" class="agf-list" role="list"></div>

          <div id="agfStatus" class="agf-status" role="status" aria-live="polite"></div>

          <div class="agf-actions">
            <button id="agfSubmit" type="submit" class="agf-btn-primary" disabled>Anonymiser les fichiers</button>
            <button id="agfReset" type="button" class="agf-btn-secondary">Effacer</button>
            <a id="agfDownload" href="#" class="agf-download" download>Télécharger le résultat</a>
          </div>
        </section>

        <section id="agfPanel-text" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-text" aria-hidden="true">
          <div class="agf-row agf-row--text">
            <div class="agf-textbox agf-textbox--flex">
              <div class="agf-textbox-head">
                <label for="agfInputText">Saisissez le texte</label>
                <button id="agfTextClear" type="button" class="agf-btn-link agf-btn-link--small" aria-label="Effacer le texte"><span class="agf-icon-trash" aria-hidden="true"></span>Effacer le texte</button>
              </div>
              <div class="agf-textbox-body">
                <textarea id="agfInputText" class="agf-textarea" placeholder="Tapez ou collez votre texte ici..."></textarea>
              </div>
            </div>
            <div class="agf-textbox agf-textbox--flex">
              <label class="agf-textbox-label">Texte traité</label>
              <div class="agf-output-wrap" id="agfOutputWrap">
                <button id="agfTextCopy" type="button" class="agf-output-copy" aria-label="Copier"><span class="agf-icon-copy" aria-hidden="true"></span>Copier</button>
                <div id="agfOutputText" class="agf-text-output" role="region" aria-live="polite">Le texte traité apparaîtra ici</div>
                <div id="agfOutputStats" class="agf-output-stats" aria-live="polite">
                  <p id="agfOutputSummary" class="agf-output-summary">Aucun champ anonymisé détecté pour l'instant.</p>
                  <div id="agfOutputEntities" class="agf-output-entities"></div>
                </div>
              </div>
            </div>
          </div>
          <p class="agf-small">Traitement automatique à la saisie (sans bouton).</p>
        </section>


        <section id="agfPanel-restore" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-restore" aria-hidden="true">
          <div class="agf-lock-block" id="agfRestoreLocked">
            <svg class="agf-lock-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="3" y="11" width="18" height="10" rx="2" stroke="currentColor" stroke-width="1.6"/>
              <path d="M7 11V8a5 5 0 0110 0v3" stroke="currentColor" stroke-width="1.6"/>
              <circle cx="12" cy="16" r="1.2" fill="currentColor"/>
            </svg>
            <p class="agf-lock-title">Restauration des pseudonymes</p>
            <p class="agf-lock-text">Module de restauration prêt côté interface. L'activation backend sera branchée dès validation du mapping sécurisé.</p>
            <button id="agfUpgradeRestore" type="button" class="agf-btn-primary">Préparer la gouvernance</button>
          </div>
        </section>
      </div>

      <aside class="agf-side" aria-label="Paramètres">
        <div class="agf-group agf-manual-auth is-collapsed" id="agfManualAuth">
          <p class="agf-label">Connexion API</p>
          <button type="button" class="agf-manual-auth-toggle" id="agfManualAuthToggle" aria-expanded="false" aria-controls="agfManualAuthFields">Utiliser des identifiants manuels</button>
          <div class="agf-manual-auth-fields" id="agfManualAuthFields" aria-hidden="true">
            <label for="agfManualUsername">Username (email)</label>
            <input type="text" id="agfManualUsername" name="agfManualUsername" placeholder="email@exemple.com" autocomplete="username">
            <label for="agfManualToken">Token</label>
            <input type="text" id="agfManualToken" name="agfManualToken" placeholder="Token API" autocomplete="off">
            <label for="agfManualEdition">Edition</label>
            <select id="agfManualEdition" name="agfManualEdition">
              <option value="free">free</option>
              <option value="pro">pro</option>
              <option value="ent">ent</option>
              <option value="anonymisation">anonymisation</option>
            </select>
          </div>
        </div>

        <div class="agf-group">
          <p class="agf-label">Mode de traitement</p>
          <label class="agf-radio-line"><input type="radio" name="agfMode" value="anonymiser" checked> Anonymiser</label>
          <button id="agfPseudoMode" type="button" class="agf-item-btn"><span>Pseudonymiser</span><span class="agf-chip" id="agfPseudoBadge">Paramétrer</span></button>
        </div>

        <div class="agf-group">
          <p class="agf-label">Paramètres</p>
          <button id="agfOpenTypes" type="button" class="agf-item-btn agf-item-btn--count">
            <span>Types de données</span>
            <span class="agf-chip-count" id="agfTypesCount">17</span>
          </button>
          <button id="agfOpenInclusion" type="button" class="agf-item-btn"><span>Inclusion / Exclusion</span><span id="agfInclusionChip" class="agf-chip">0 / 0</span></button>
        </div>

        <div class="agf-group">
          <p class="agf-label">Enregistré</p>
          <button id="agfPseudoSaved" type="button" class="agf-item-btn"><span>Pseudonymes</span><span class="agf-chip">Gérer</span></button>
          <p id="agfPseudoSummary" class="agf-small">Pseudo: configuration standard</p>
          <p id="agfSavedTypesInfo" class="agf-small">Types actifs: 0</p>
          <p id="agfLastMaskInfo" class="agf-small">Champs anonymisés (texte): 0</p>
        </div>

        <p id="agfApiMeta" class="agf-small">API: vérification...</p>
        <p class="agf-small"><a href="https://api.agilotext.com/html/menu.html" target="_blank" rel="noopener noreferrer" id="agfApiLink">API Agilotext</a></p>
      </aside>
    </div>
  </section>
</form>

<div id="agfModalTypesWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalTypesTitle" aria-hidden="true">
  <div class="agf-modal">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalTypesTitle" class="agf-modal-title">Sélectionnez les types de données</h3>
        <p class="agf-modal-subtitle">Ces préférences sont enregistrées et appliquées aux prochains traitements.</p>
      </div>
      <button id="agfModalTypesClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-type-grid" id="agfTypeGrid">
      <section class="agf-type-card" data-type-group="person">
        <div class="agf-type-card-head">
          <h5>Données personnelles</h5>
          <span class="agf-type-card-count" id="agfGroupCount-person">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="PR" data-api="person_name" checked><span class="agf-entity-code">PR</span><span class="agf-entity-name">Nom de personne</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="MAIL" data-api="email" checked><span class="agf-entity-code">MAIL</span><span class="agf-entity-name">Adresse email</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="PHON" data-api="phone" checked><span class="agf-entity-code">PHON</span><span class="agf-entity-name">Téléphone</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="AGE" data-api="birth" checked><span class="agf-entity-code">AGE</span><span class="agf-entity-name">Âge / naissance</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="TR" data-api="role" checked><span class="agf-entity-code">TR</span><span class="agf-entity-name">Titre / profession</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="DT" data-api="" checked><span class="agf-entity-code">DT</span><span class="agf-entity-name">Date et heure</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="company">
        <div class="agf-type-card-head">
          <h5>Données d'entreprise</h5>
          <span class="agf-type-card-count" id="agfGroupCount-company">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="CIE" data-api="company" checked><span class="agf-entity-code">CIE</span><span class="agf-entity-name">Nom d'entreprise</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CID" data-api="siren" checked><span class="agf-entity-code">CID</span><span class="agf-entity-name">Identifiant administratif</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="ACT" data-api="accounting" checked><span class="agf-entity-code">ACT</span><span class="agf-entity-name">Entrée comptable</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="PROD" data-api="product" checked><span class="agf-entity-code">PROD</span><span class="agf-entity-name">Produit / service</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="ORG" data-api="company" checked><span class="agf-entity-code">ORG</span><span class="agf-entity-name">Organisation</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FILE" data-api=""><span class="agf-entity-code">FILE</span><span class="agf-entity-name">Nom de dossier</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="location">
        <div class="agf-type-card-head">
          <h5>Données de localisation</h5>
          <span class="agf-type-card-count" id="agfGroupCount-location">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="ADR" data-api="address" checked><span class="agf-entity-code">ADR</span><span class="agf-entity-name">Adresse</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="POST" data-api="address" checked><span class="agf-entity-code">POST</span><span class="agf-entity-name">Code postal</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="LOC" data-api="address" checked><span class="agf-entity-code">LOC</span><span class="agf-entity-name">Ville / région</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="GEO" data-api=""><span class="agf-entity-code">GEO</span><span class="agf-entity-name">Géolocalisation</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="finance">
        <div class="agf-type-card-head">
          <h5>Données financières</h5>
          <span class="agf-type-card-count" id="agfGroupCount-finance">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="BANK" data-api="bank" checked><span class="agf-entity-code">BANK</span><span class="agf-entity-name">Compte bancaire</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CARD" data-api="bank" checked><span class="agf-entity-code">CARD</span><span class="agf-entity-name">Carte bancaire</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="REF" data-api="contract" checked><span class="agf-entity-code">REF</span><span class="agf-entity-name">Numéro de référence</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="MT" data-api=""><span class="agf-entity-code">MT</span><span class="agf-entity-name">Montant</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="IBAN" data-api=""><span class="agf-entity-code">IBAN</span><span class="agf-entity-name">IBAN</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="misc">
        <div class="agf-type-card-head">
          <h5>Données diverses</h5>
          <span class="agf-type-card-count" id="agfGroupCount-misc">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="URL" data-api=""><span class="agf-entity-code">URL</span><span class="agf-entity-name">URL</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="IP" data-api=""><span class="agf-entity-code">IP</span><span class="agf-entity-name">Adresse IP</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CLAUSE" data-api="contract"><span class="agf-entity-code">CLAUSE</span><span class="agf-entity-name">Clause sensible</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="france">
        <div class="agf-type-card-head">
          <h5>Formats spécifiques France</h5>
          <span class="agf-type-card-count" id="agfGroupCount-france">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRNIR" data-api=""><span class="agf-entity-code">FRNIR</span><span class="agf-entity-name">NIR</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRPASS" data-api=""><span class="agf-entity-code">FRPASS</span><span class="agf-entity-name">Passeport</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRCNI" data-api=""><span class="agf-entity-code">FRCNI</span><span class="agf-entity-name">Carte d'identité</span></label>
        </div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <div class="agf-actions">
        <button id="agfDefaultsTypes" type="button" class="agf-btn-secondary">Paramètres par défaut</button>
        <button id="agfDetectAllTypes" type="button" class="agf-btn-link">Tout détecter</button>
        <button id="agfIgnoreAllTypes" type="button" class="agf-btn-link">Tout ignorer</button>
      </div>
      <button id="agfSaveTypes" type="button" class="agf-btn-primary">Enregistrer</button>
    </div>
  </div>
</div>

<div id="agfModalPseudoWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalPseudoTitle" aria-hidden="true">
  <div class="agf-modal agf-modal--wide">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalPseudoTitle" class="agf-modal-title">Pseudonymisation pilotée</h3>
        <p class="agf-modal-subtitle">Définissez une politique robuste de pseudonymisation. L'interface est prête et les paramètres seront appliqués sans rupture lors de l'activation backend.</p>
      </div>
      <button id="agfModalPseudoClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-pseudo-grid">
      <section class="agf-pseudo-card">
        <p class="agf-pseudo-title">Stratégie de remplacement</p>
        <p class="agf-pseudo-desc">Détermine le format des valeurs pseudonymisées dans les résultats et exports.</p>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyPlaceholders" type="radio" name="agfPseudoStrategy" value="placeholders" checked>
          <label for="agfPseudoStrategyPlaceholders">Identifiants lisibles (ex: [PR-0001])</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyStable" type="radio" name="agfPseudoStrategy" value="stable_hash">
          <label for="agfPseudoStrategyStable">Jeton stable (hash cohérent)</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyAlias" type="radio" name="agfPseudoStrategy" value="human_alias">
          <label for="agfPseudoStrategyAlias">Alias métier (lecture humaine contrôlée)</label>
        </div>
        <div class="agf-select-line">
          <label for="agfPseudoScope">Périmètre de cohérence</label>
          <select id="agfPseudoScope">
            <option value="document">Document</option>
            <option value="batch">Lot de fichiers</option>
            <option value="workspace">Espace client</option>
          </select>
        </div>
      </section>

      <section class="agf-pseudo-card">
        <p class="agf-pseudo-title">Sécurité et restauration</p>
        <p class="agf-pseudo-desc">Définit la gouvernance de clé et la politique de restauration.</p>
        <div class="agf-select-line">
          <label for="agfPseudoKeyMode">Gestion de clé</label>
          <select id="agfPseudoKeyMode">
            <option value="server">Clé serveur managée</option>
            <option value="client">Clé client (BYOK)</option>
            <option value="hsm">HSM / KMS dédié</option>
          </select>
        </div>
        <div class="agf-select-line">
          <label for="agfPseudoRestoreWindow">Fenêtre de restauration</label>
          <select id="agfPseudoRestoreWindow">
            <option value="24h">24 heures</option>
            <option value="7d">7 jours</option>
            <option value="30d" selected>30 jours</option>
            <option value="never">Aucune restauration</option>
          </select>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoDeterministic" type="checkbox" checked>
          <label for="agfPseudoDeterministic">Même donnée source -> même pseudonyme</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoPreserveFormat" type="checkbox" checked>
          <label for="agfPseudoPreserveFormat">Préserver la structure (longueur, séparateurs)</label>
        </div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <button id="agfPseudoDefaults" type="button" class="agf-btn-secondary">Réinitialiser</button>
      <button id="agfSavePseudo" type="button" class="agf-btn-primary">Enregistrer la politique</button>
    </div>
  </div>
</div>

<div id="agfModalInclusionWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalIncTitle" aria-hidden="true">
  <div class="agf-modal agf-modal--wide">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalIncTitle" class="agf-modal-title">Inclusion / Exclusion</h3>
        <p class="agf-modal-subtitle">Gérez les listes d'inclusion et d'exclusion pour réduire les faux positifs et faux négatifs. La comparaison ignore la casse et les accents.</p>
      </div>
      <button id="agfModalIncClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-inc-grid">
      <section class="agf-inc-card agf-inc-card--include">
        <h4>Liste d'inclusion</h4>
        <p>Ces termes sont toujours détectés et anonymisés, même hors des types sélectionnés.</p>
        <div class="agf-inc-add">
          <input id="agfIncludeInput" type="text" placeholder="Ajouter un terme à inclure...">
          <button id="agfIncludeAdd" type="button">Ajouter</button>
        </div>
        <div id="agfIncludeList" class="agf-term-list" aria-live="polite"></div>
      </section>

      <section class="agf-inc-card agf-inc-card--exclude">
        <h4>Liste d'exclusion</h4>
        <p>Ces termes sont systématiquement ignorés lors de l'anonymisation, même s'ils correspondent aux types sélectionnés.</p>
        <div class="agf-inc-add">
          <input id="agfExcludeInput" type="text" placeholder="Ajouter un terme à exclure...">
          <button id="agfExcludeAdd" type="button">Ajouter</button>
        </div>
        <div id="agfExcludeList" class="agf-term-list" aria-live="polite"></div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <span id="agfIncSummary" class="agf-small">Inclusion: 0 · Exclusion: 0</span>
      <div class="agf-actions">
        <button id="agfInclusionDefaults" type="button" class="agf-btn-secondary">Vider les listes</button>
        <button id="agfSaveInclusion" type="button" class="agf-btn-primary">Enregistrer les listes</button>
      </div>
    </div>

    <textarea id="agfIncludeTerms" class="agf-hidden-field" aria-hidden="true"></textarea>
    <textarea id="agfExcludeTerms" class="agf-hidden-field" aria-hidden="true"></textarea>
  </div>
</div>

  <script src="agiloshield-embed-anonymisation.js"></script>
</body>
</html>

