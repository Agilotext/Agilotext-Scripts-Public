<!--
  Agiloshield Embed - Anonymisation (HTML + CSS uniquement)
  APIs: getToken, anonOfficeText, anonText, cleanupOldJobs, getVersion

  USAGE WEBFLOW :
  1. Copier tout ce fichier (FINAL.html) dans un bloc Embed.
  2. Ajouter juste après (même embed ou bloc Embed suivant) le chargement du script :
     <script src="https://cdn.jsdelivr.net/gh/Agilotext/Agilotext-Scripts-Public@main/CNOEC_Agiloshield_Docs/Front_END/agiloshield-embed-anonymisation.js"></script>
-->
<style>
  /* Éviter qu'un overlay (extension type Plasmo, etc.) bloque les clics */
  plasmo-csui, #plasmo-inspector, [id^="plasmo-"] { pointer-events: none !important; }
  plasmo-csui * { pointer-events: none !important; }
</style>
<style>
  :root {
    --agilo-primary: var(--color--blue, #174a96);
    --agilo-primary-soft: color-mix(in srgb, var(--color--blue, #174a96) 12%, transparent);
    --agilo-text: var(--color--gris_foncé, #020202);
    --agilo-text-secondary: var(--color--gris, #525252);
    --agilo-surface: var(--color--white, #ffffff);
    --agilo-surface-2: var(--color--blanc_gris, #f8f9fa);
    --agilo-border: rgba(52, 58, 64, 0.12);
    --agilo-success: var(--color--vert, #1c661a);
    --agilo-error: var(--color--rouge, #a82633);

    --space-1: 8px;
    --space-2: 16px;
    --space-3: 24px;
    --space-4: 32px;
    --radius: 16px;
    --ring: color-mix(in srgb, var(--agilo-primary) 28%, transparent);
    --shadow-soft: 0 8px 28px rgba(23, 74, 150, 0.1);
  }

  form[ms-code-anonymisation="form"] {
    max-width: 1160px;
    margin: 0 auto;
    width: 100%;
    color: var(--agilo-text);
    font-family: "Inter", "SF Pro Text", "Segoe UI", sans-serif;
    box-sizing: border-box;
  }
  form[ms-code-anonymisation="form"] *,
  form[ms-code-anonymisation="form"] *::before,
  form[ms-code-anonymisation="form"] *::after {
    box-sizing: border-box;
  }
  form[ms-code-anonymisation="form"] h1,
  form[ms-code-anonymisation="form"] h2,
  form[ms-code-anonymisation="form"] h3,
  form[ms-code-anonymisation="form"] h4,
  form[ms-code-anonymisation="form"] h5,
  form[ms-code-anonymisation="form"] p { margin: 0; }

  .agf-shell {
    background: var(--agilo-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
    padding: var(--space-4);
    display: grid;
    gap: var(--space-2);
  }

  .agf-head {
    display: grid;
    gap: var(--space-1);
    padding: 0;
  }
  .agf-head h2 { font-size: 1.35rem; line-height: 1.25; font-weight: 600; letter-spacing: -0.01em; }
  .agf-head p { color: var(--agilo-text-secondary); font-size: 0.9375rem; }

  .agf-tabs {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: var(--space-1);
  }
  .agf-tab {
    border: 1px solid var(--agilo-border);
    border-radius: 12px;
    background: var(--agilo-surface-2);
    color: var(--agilo-text-secondary);
    padding: var(--space-2);
    text-align: left;
    cursor: pointer;
    display: grid;
    gap: var(--space-1);
    transition: border-color 150ms ease, box-shadow 150ms ease;
  }
  .agf-tab strong { font-size: 1rem; font-weight: 600; color: var(--agilo-text); }
  .agf-tab span { font-size: 0.8125rem; color: var(--agilo-text-secondary); }
  .agf-tab[aria-selected="true"] {
    background: var(--agilo-surface);
    border-color: var(--agilo-primary);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--agilo-primary) 18%, transparent);
  }

  .agf-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 280px;
    gap: var(--space-2);
  }

  .agf-main,
  .agf-side {
    border-radius: var(--radius);
    background: var(--agilo-surface-2);
    padding: var(--space-3);
  }
  .agf-main { min-height: 560px; }
  .agf-side { display: grid; gap: var(--space-3); align-content: start; }

  .agf-panel { display: none; gap: var(--space-2); }
  .agf-panel[aria-hidden="false"] { display: grid; }

  .agf-section-title { font-size: 1rem; font-weight: 600; margin-bottom: var(--space-1); }

  .agf-dropzone {
    border: 1.5px dashed var(--agilo-border);
    border-radius: 12px;
    background: var(--agilo-surface-2);
    padding: var(--space-3) var(--space-2);
    text-align: center;
    cursor: pointer;
    transition: border-color 150ms ease, box-shadow 150ms ease;
    outline: none;
  }
  .agf-dropzone:hover,
  .agf-dropzone:focus-visible,
  .agf-dropzone.is-dragover {
    border-color: var(--agilo-primary);
    box-shadow: 0 0 0 4px var(--ring);
  }
  .agf-dropzone h4 { font-size: 1rem; font-weight: 600; }
  .agf-dropzone p { margin-top: var(--space-1); font-size: 0.8125rem; color: var(--agilo-text-secondary); }
  .agf-dropzone .agf-formats-explicit { margin-top: var(--space-1); font-size: 0.75rem; color: var(--agilo-text-secondary); opacity: 0.9; }
  #agfApiLink { color: var(--agilo-text-secondary); text-decoration: none; font-size: 0.75rem; }
  #agfApiLink:hover { text-decoration: underline; color: var(--agilo-primary); }

  #agfFileInput { display: none; }

  .agf-list {
    border: 1px solid var(--agilo-border);
    border-radius: 12px;
    background: var(--agilo-surface);
    min-height: 220px;
    padding: var(--space-2);
    display: grid;
    gap: var(--space-1);
    align-content: start;
  }
  .agf-empty { margin: auto; text-align: center; color: var(--agilo-text-secondary); font-size: 0.875rem; }

  .agf-file {
    border: 1px solid var(--agilo-border);
    border-radius: 10px;
    background: var(--agilo-surface);
    padding: var(--space-1) var(--space-2);
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    align-items: center;
    gap: var(--space-2);
  }
  .agf-file-name { font-size: 0.9375rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .agf-file-meta { margin-top: 2px; color: var(--agilo-text-secondary); font-size: 0.8125rem; }
  .agf-remove {
    border: none;
    border-radius: 8px;
    background: transparent;
    color: var(--agilo-text-secondary);
    font-size: 0.8125rem;
    font-weight: 500;
    padding: 6px 12px;
    cursor: pointer;
  }
  .agf-remove:hover { color: var(--agilo-error); }

  .agf-row,
  .agf-cols { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: var(--space-2); }

  .agf-textbox {
    border: 1px solid var(--agilo-border);
    border-radius: 12px;
    background: var(--agilo-surface);
    padding: var(--space-2);
    display: grid;
    gap: var(--space-1);
    min-height: 340px;
  }
  .agf-textbox label { font-size: 0.875rem; font-weight: 600; }
  .agf-textarea {
    width: 100%; min-height: 280px; border: 1px solid var(--agilo-border); border-radius: 10px;
    padding: var(--space-2); font-size: 0.9375rem; line-height: 1.5; resize: vertical; background: var(--agilo-surface);
    color: var(--agilo-text);
  }
  .agf-row--text { min-height: 340px; }
  .agf-textbox--flex { display: flex; flex-direction: column; gap: var(--space-1); min-height: 0; }
  .agf-textbox-head { display: flex; justify-content: space-between; align-items: flex-start; gap: var(--space-2); }
  .agf-textbox-body { flex: 1; overflow: hidden; display: flex; min-height: 0; }
  .agf-textbox-body .agf-textarea { min-height: 260px; flex: 1; }
  .agf-textbox-label { font-size: 0.875rem; font-weight: 600; margin-bottom: var(--space-1); }
  .agf-btn-link--small { font-size: 0.75rem; padding: 0; min-height: auto; }
  .agf-icon-trash, .agf-icon-copy { display: inline-block; width: 14px; height: 14px; vertical-align: -2px; margin-right: 4px; }
  .agf-icon-trash { background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6'/%3E%3Cpath d='M3 6h18'/%3E%3Cpath d='M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2'/%3E%3C/svg%3E") no-repeat center; }
  .agf-icon-copy { background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Crect width='14' height='14' x='8' y='8' rx='2' ry='2'/%3E%3Cpath d='M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2'/%3E%3C/svg%3E") no-repeat center; }
  .agf-output-wrap {
    flex: 1; min-height: 260px; border-radius: 12px;
    border: 1px solid color-mix(in srgb, var(--agilo-primary) 28%, transparent);
    background: color-mix(in srgb, var(--agilo-primary) 5%, var(--agilo-surface));
    padding: var(--space-2); padding-top: 36px; position: relative; overflow-y: auto;
  }
  .agf-output-copy {
    position: absolute; top: 10px; right: 12px; z-index: 10;
    height: 28px; padding: 0 10px; font-size: 0.75rem; font-weight: 500;
    border-radius: 6px; border: none; background: var(--agilo-primary); color: var(--agilo-surface);
    cursor: pointer; display: inline-flex; align-items: center; gap: 6px;
  }
  .agf-output-copy:hover { background: color-mix(in srgb, var(--agilo-primary) 88%, var(--agilo-text-secondary)); }
  .agf-text-output {
    font-size: 0.875rem; line-height: 1.6; color: var(--agilo-text); white-space: pre-wrap; word-break: break-word;
    background: color-mix(in srgb, var(--agilo-primary) 4%, var(--agilo-surface));
    border: 1px solid color-mix(in srgb, var(--agilo-primary) 14%, transparent);
    border-radius: 12px;
    padding: var(--space-2);
    min-height: 120px;
  }
  .agf-text-output.agf-text-output--loading { opacity: 0.85; }
  .agf-output-stats {
    margin-top: var(--space-2);
    border-top: 1px solid color-mix(in srgb, var(--agilo-primary) 20%, transparent);
    padding-top: 10px;
    display: grid;
    gap: 8px;
  }
  .agf-output-summary { font-size: 0.75rem; color: var(--agilo-text-secondary); }
  .agf-output-entities { display: flex; flex-wrap: wrap; gap: 6px; }
  .agf-output-entity-chip {
    border-radius: 999px;
    border: 1px solid color-mix(in srgb, var(--agilo-primary) 28%, transparent);
    background: color-mix(in srgb, var(--agilo-primary) 8%, var(--agilo-surface));
    color: var(--agilo-text);
    font-size: 0.75rem;
    line-height: 1;
    padding: 5px 8px;
  }
  .agf-tag {
    border-radius: 5px;
    padding: 2px 6px;
    font-size: 0.8125rem;
    font-weight: 600;
    border: 1px solid color-mix(in srgb, var(--agilo-primary) 26%, transparent);
  }
  .agf-tag-PR { background: #fef9c3; color: #422006; }
  .agf-tag-ADR { background: #dbeafe; color: #1e3a8a; }
  .agf-tag-POST { background: #d1fae5; color: #065f46; }
  .agf-tag-LOC { background: #e9d5ff; color: #5b21b6; }
  .agf-tag-MAIL { background: #ffedd5; color: #9a3412; }
  .agf-tag-PHON { background: #ccfbf1; color: #0f766e; }
  .agf-tag-SIREN, .agf-tag-SIRET { background: #fce7f3; color: #831843; }
  .agf-tag-OTHER { background: #f3f4f6; color: #374151; }

  .agf-lock-block {
    border: 1.5px dashed var(--agilo-border);
    border-radius: 12px;
    background: var(--agilo-surface-2);
    min-height: 380px;
    display: grid;
    place-items: center;
    gap: var(--space-2);
    text-align: center;
    padding: var(--space-3);
  }
  .agf-lock-icon { width: 64px; height: 64px; color: var(--agilo-primary); }
  .agf-lock-title { font-size: 1rem; font-weight: 600; }
  .agf-lock-text { color: var(--agilo-text-secondary); font-size: 0.875rem; max-width: 480px; }

  .agf-status {
    display: none; align-items: center; gap: var(--space-1); border-radius: 10px;
    padding: var(--space-2); font-size: 0.9375rem;
  }
  .agf-status.is-visible { display: inline-flex; }
  .agf-status[data-kind="loading"] { color: var(--agilo-primary); background: var(--agilo-primary-soft); }
  .agf-status[data-kind="success"] { color: var(--agilo-success); background: color-mix(in srgb, var(--agilo-success) 10%, transparent); }
  .agf-status[data-kind="error"] { color: var(--agilo-error); background: color-mix(in srgb, var(--agilo-error) 10%, transparent); }
  .agf-spinner { width: 16px; height: 16px; border: 2px solid currentColor; border-right-color: transparent; border-radius: 50%; animation: agf-spin .7s linear infinite; }
  @keyframes agf-spin { to { transform: rotate(360deg); } }

  .agf-actions { display: flex; gap: var(--space-2); flex-wrap: wrap; align-items: center; }
  .agf-btn-primary,
  .agf-btn-secondary,
  .agf-btn-link { min-height: 44px; border-radius: 10px; font-size: 0.9375rem; font-weight: 600; padding: 0 24px; cursor: pointer; transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, box-shadow 160ms ease; }
  .agf-btn-primary { border: none; background: var(--agilo-primary); color: var(--agilo-surface); }
  .agf-btn-primary:hover:not(:disabled) { background: color-mix(in srgb, var(--agilo-primary) 90%, var(--agilo-text-secondary)); }
  .agf-btn-primary:disabled { opacity: .5; cursor: not-allowed; }
  .agf-btn-primary:focus-visible,
  .agf-btn-secondary:focus-visible,
  .agf-btn-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 28%, transparent);
  }
  .agf-btn-secondary { border: none; background: transparent; color: var(--agilo-text-secondary); text-decoration: underline; text-underline-offset: 2px; }
  .agf-btn-secondary:hover { color: var(--agilo-primary); }
  .agf-btn-link { border: none; background: transparent; color: var(--agilo-text-secondary); text-decoration: underline; text-underline-offset: 2px; }
  .agf-btn-link:hover { color: var(--agilo-primary); }

  .agf-download { display: none; color: var(--agilo-primary); text-decoration: underline; text-underline-offset: 2px; font-size: 0.9375rem; font-weight: 500; padding: 0; }
  .agf-download.is-visible { display: inline-flex; }

  .agf-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: .04em; color: var(--agilo-text-secondary); }
  .agf-group { display: grid; gap: var(--space-1); }
  .agf-radio-line,
  .agf-item-btn {
    border: 1px solid var(--agilo-border);
    border-radius: 10px;
    background: var(--agilo-surface);
    min-height: 44px;
    padding: var(--space-1) var(--space-2);
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.875rem;
  }
  .agf-radio-line input[type="radio"] { accent-color: var(--agilo-primary); }
  .agf-radio-line:focus-within {
    border-color: color-mix(in srgb, var(--agilo-primary) 40%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 18%, transparent);
  }
  .agf-item-btn { width: 100%; justify-content: space-between; cursor: pointer; color: var(--agilo-text); }
  .agf-item-btn:hover { border-color: color-mix(in srgb, var(--agilo-primary) 32%, transparent); }
  .agf-item-btn:focus-visible {
    outline: none;
    border-color: color-mix(in srgb, var(--agilo-primary) 38%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 18%, transparent);
  }
  .agf-item-btn.is-active { border-color: color-mix(in srgb, var(--agilo-primary) 40%, transparent); background: color-mix(in srgb, var(--agilo-primary) 7%, var(--agilo-surface)); }
  .agf-chip {
    font-size: 0.6875rem; border: 1px solid var(--agilo-border); border-radius: 999px;
    padding: 2px 8px; color: var(--agilo-text-secondary); background: var(--agilo-surface-2);
  }
  .agf-item-btn--count { position: relative; padding-right: 48px; }
  .agf-chip-count {
    position: absolute;
    top: -8px;
    right: -8px;
    min-width: 22px;
    height: 22px;
    border-radius: 999px;
    background: var(--agilo-primary);
    color: var(--agilo-surface);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6875rem;
    font-weight: 700;
    border: 2px solid var(--agilo-surface);
  }

  .agf-small { font-size: 0.8125rem; color: var(--agilo-text-secondary); }

  .agf-modal-overlay {
    position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
    background: rgba(23, 74, 150, 0.2); z-index: 9999; padding: var(--space-2);
    backdrop-filter: blur(2px);
  }
  .agf-modal-overlay.is-open { display: flex; }
  .agf-modal {
    width: min(560px, 100%); max-height: min(85vh, 680px); overflow: auto;
    background: var(--agilo-surface); border-radius: var(--radius);
    box-shadow: 0 22px 48px rgba(23, 74, 150, 0.2);
    padding: clamp(20px, 3vw, 30px);
    display: grid;
    gap: 18px;
  }
  #agfModalTypesWrap .agf-modal { width: min(980px, 100%); max-height: min(88vh, 760px); }
  .agf-modal-head { display: flex; justify-content: center; align-items: start; gap: 14px; position: relative; padding-right: 44px; }
  .agf-modal-title { font-size: 1.375rem; font-weight: 600; line-height: 1.2; letter-spacing: -0.01em; text-align: center; flex: 1; }
  .agf-modal-subtitle { margin-top: 6px; font-size: 0.875rem; line-height: 1.45; color: var(--agilo-text-secondary); max-width: 72ch; text-align: center; margin-left: auto; margin-right: auto; }
  .agf-close {
    border: 1px solid transparent;
    background: transparent;
    font-size: 1.5rem;
    line-height: 1;
    color: var(--agilo-text-secondary);
    cursor: pointer;
    padding: 2px 8px;
    border-radius: 8px;
    transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
  }
  .agf-close { position: absolute; top: 0; right: 0; }
  .agf-close:hover { color: var(--agilo-text); }
  .agf-close:focus-visible {
    outline: none;
    border-color: color-mix(in srgb, var(--agilo-primary) 38%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 18%, transparent);
  }

  .agf-type-grid { display: grid; gap: 14px; }
  .agf-type-card {
    border: 1px solid var(--agilo-border);
    border-radius: 14px;
    padding: 14px;
    display: grid;
    gap: 12px;
    background: var(--agilo-surface);
  }
  .agf-type-card-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-1);
  }
  .agf-type-card h5 {
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: .04em;
    color: var(--agilo-text-secondary);
  }
  .agf-type-card-count {
    border-radius: 999px;
    font-size: 0.6875rem;
    border: 1px solid var(--agilo-border);
    padding: 2px 8px;
    color: var(--agilo-text-secondary);
    background: var(--agilo-surface-2);
  }
  .agf-checkboxes { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
  .agf-entity-option {
    border: 1px solid var(--agilo-border);
    border-radius: 10px;
    min-height: 44px;
    padding: 10px;
    font-size: 0.875rem;
    display: flex;
    gap: 8px;
    align-items: center;
    background: var(--agilo-surface);
    cursor: pointer;
    transition: border-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease;
  }
  .agf-entity-option:hover { border-color: color-mix(in srgb, var(--agilo-primary) 30%, transparent); }
  .agf-entity-option:focus-within {
    border-color: color-mix(in srgb, var(--agilo-primary) 40%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 16%, transparent);
  }
  .agf-entity-option input { accent-color: var(--agilo-primary); margin: 0; }
  .agf-entity-option input:checked + .agf-entity-code {
    background: color-mix(in srgb, var(--agilo-primary) 16%, var(--agilo-surface));
    border-color: color-mix(in srgb, var(--agilo-primary) 42%, transparent);
  }
  .agf-entity-code {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    border: 1px solid color-mix(in srgb, var(--agilo-primary) 30%, transparent);
    background: color-mix(in srgb, var(--agilo-primary) 8%, var(--agilo-surface));
    color: color-mix(in srgb, var(--agilo-primary) 80%, var(--agilo-text));
    font-size: 0.6875rem;
    font-weight: 700;
    line-height: 1;
    padding: 4px 8px;
    min-width: 38px;
  }
  .agf-entity-name { color: var(--agilo-text); }
  .agf-entity-option.is-future .agf-entity-name { color: var(--agilo-text-secondary); }
  .agf-entity-option.is-future .agf-entity-code { border-style: dashed; }

  .agf-modal-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-2);
    flex-wrap: wrap;
    border-top: 1px solid color-mix(in srgb, var(--agilo-border) 80%, transparent);
    padding-top: 14px;
  }
  .agf-textbox--compact { min-height: auto; }
  .agf-textarea--modal { min-height: 200px; }
  .agf-actions--end { justify-content: flex-end; }
  .agf-modal--wide { width: min(900px, 100%); max-height: min(88vh, 760px); }
  .agf-pseudo-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 18px; }
  .agf-pseudo-card {
    border: 1px solid var(--agilo-border);
    border-radius: 14px;
    background: var(--agilo-surface);
    padding: 14px;
    display: grid;
    gap: 12px;
  }
  .agf-pseudo-title { font-size: 0.875rem; font-weight: 600; color: var(--agilo-text); }
  .agf-pseudo-desc { font-size: 0.75rem; color: var(--agilo-text-secondary); }
  .agf-option-line {
    border: 1px solid var(--agilo-border);
    border-radius: 10px;
    min-height: 42px;
    padding: 8px 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--agilo-surface);
    transition: border-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease;
  }
  .agf-option-line:hover { border-color: color-mix(in srgb, var(--agilo-primary) 28%, transparent); }
  .agf-option-line:focus-within {
    border-color: color-mix(in srgb, var(--agilo-primary) 38%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 16%, transparent);
  }
  .agf-option-line input[type="radio"],
  .agf-option-line input[type="checkbox"] { accent-color: var(--agilo-primary); }
  .agf-option-line label { font-size: 0.8125rem; font-weight: 500; cursor: pointer; }
  .agf-select-line {
    display: grid;
    gap: 4px;
  }
  .agf-select-line label { font-size: 0.75rem; color: var(--agilo-text-secondary); }
  .agf-select-line select {
    min-height: 38px;
    border: 1px solid var(--agilo-border);
    border-radius: 8px;
    background: var(--agilo-surface);
    color: var(--agilo-text);
    padding: 0 10px;
    transition: border-color 160ms ease, box-shadow 160ms ease;
  }
  .agf-select-line select:focus-visible {
    outline: none;
    border-color: color-mix(in srgb, var(--agilo-primary) 38%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 16%, transparent);
  }
  .agf-inc-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 18px; }
  .agf-inc-card {
    border: 1px solid var(--agilo-border);
    border-radius: 14px;
    padding: 14px;
    background: var(--agilo-surface);
    display: grid;
    gap: 12px;
  }
  .agf-inc-card h4 { font-size: 0.9375rem; font-weight: 600; }
  .agf-inc-card p { font-size: 0.75rem; color: var(--agilo-text-secondary); }
  .agf-inc-card--include h4 { color: color-mix(in srgb, var(--agilo-success) 80%, var(--agilo-text)); }
  .agf-inc-card--exclude h4 { color: color-mix(in srgb, var(--agilo-error) 80%, var(--agilo-text)); }
  .agf-inc-add { display: flex; gap: 8px; align-items: center; }
  .agf-inc-add input {
    flex: 1;
    min-height: 36px;
    border: 1px solid var(--agilo-border);
    border-radius: 8px;
    background: var(--agilo-surface);
    color: var(--agilo-text);
    padding: 0 10px;
    font-size: 0.8125rem;
    transition: border-color 160ms ease, box-shadow 160ms ease;
  }
  .agf-inc-add input:focus-visible {
    outline: none;
    border-color: color-mix(in srgb, var(--agilo-primary) 40%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 16%, transparent);
  }
  .agf-inc-add button {
    min-height: 36px;
    border-radius: 8px;
    border: 1px solid var(--agilo-border);
    background: var(--agilo-surface);
    color: var(--agilo-text);
    padding: 0 12px;
    font-size: 0.8125rem;
    font-weight: 600;
    cursor: pointer;
    transition: border-color 160ms ease, color 160ms ease, box-shadow 160ms ease, background-color 160ms ease;
  }
  .agf-inc-add button:hover { border-color: color-mix(in srgb, var(--agilo-primary) 45%, transparent); color: var(--agilo-primary); }
  .agf-inc-add button:focus-visible {
    outline: none;
    border-color: color-mix(in srgb, var(--agilo-primary) 40%, transparent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--agilo-primary) 16%, transparent);
  }
  .agf-term-list {
    border: 1px solid var(--agilo-border);
    border-radius: 10px;
    background: var(--agilo-surface-2);
    min-height: 120px;
    max-height: 220px;
    overflow-y: auto;
    padding: 8px;
    display: grid;
    gap: 6px;
    align-content: start;
  }
  .agf-term-empty { font-size: 0.75rem; color: var(--agilo-text-secondary); text-align: center; padding: 10px 0; }
  .agf-term-item {
    border: 1px solid var(--agilo-border);
    border-radius: 8px;
    background: var(--agilo-surface);
    padding: 6px 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }
  .agf-term-item span { font-size: 0.8125rem; color: var(--agilo-text); word-break: break-word; }
  .agf-term-remove {
    border: none;
    background: transparent;
    color: var(--agilo-text-secondary);
    font-size: 0.75rem;
    cursor: pointer;
    padding: 0;
  }
  .agf-term-remove:hover { color: var(--agilo-error); }
  .agf-term-remove:focus-visible {
    outline: none;
    color: var(--agilo-error);
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .agf-hidden-field { display: none; }

  .agf-manual-auth { display: grid; gap: var(--space-1); }
  .agf-manual-auth.is-collapsed .agf-manual-auth-fields { display: none; }
  .agf-manual-auth-toggle { border: none; background: none; color: var(--agilo-primary); font-size: 0.8125rem; cursor: pointer; padding: 0; text-decoration: underline; text-underline-offset: 2px; }
  .agf-manual-auth-toggle:hover { color: var(--agilo-text); }
  .agf-manual-auth-fields { display: grid; gap: var(--space-1); }
  .agf-manual-auth label { font-size: 0.75rem; color: var(--agilo-text-secondary); display: block; margin-bottom: 2px; }
  .agf-manual-auth input { width: 100%; padding: 6px 8px; font-size: 0.8125rem; border: 1px solid var(--agilo-border); border-radius: 6px; }
  .agf-manual-auth select { width: 100%; padding: 6px 8px; font-size: 0.8125rem; border: 1px solid var(--agilo-border); border-radius: 6px; background: var(--agilo-surface); }

  @media (max-width: 980px) {
    .agf-grid { grid-template-columns: 1fr; }
    .agf-side { order: -1; }
  }
  @media (max-width: 760px) {
    .agf-tabs,
    .agf-row,
    .agf-cols,
    .agf-checkboxes,
    .agf-pseudo-grid,
    .agf-inc-grid { grid-template-columns: 1fr; }
    .agf-actions { flex-direction: column; align-items: stretch; }
    .agf-btn-primary,
    .agf-download { width: 100%; justify-content: center; text-align: center; }
  }
</style>

<form id="agfForm" ms-code-anonymisation="form" novalidate>
  <input type="hidden" name="memberEmail" data-ms-member-email="" ms-code-member-email>

  <section class="agf-shell" aria-label="Anonymisation avancée">
    <header class="agf-head">
      <h2>Anonymisation documentaire</h2>
      <p>Flux unifié pour fichiers, texte et restauration avec gouvernance de sécurité.</p>
    </header>

    <div class="agf-tabs" role="tablist" aria-label="Modes de traitement">
      <button id="agfTab-file" class="agf-tab" type="button" role="tab" aria-selected="true" aria-controls="agfPanel-file" data-tab="file">
        <strong>Traitement de fichier</strong>
        <span>PDF, Image, CSV, FEC, etc.</span>
      </button>
      <button id="agfTab-text" class="agf-tab" type="button" role="tab" aria-selected="false" aria-controls="agfPanel-text" data-tab="text">
        <strong>Traitement de texte</strong>
        <span>Email, Markdown, etc.</span>
      </button>
      <button id="agfTab-restore" class="agf-tab" type="button" role="tab" aria-selected="false" aria-controls="agfPanel-restore" data-tab="restore">
        <strong>Restauration</strong>
        <span>Restaurez les données pseudonymisées</span>
      </button>
    </div>

    <div class="agf-grid">
      <div class="agf-main">
        <section id="agfPanel-file" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-file" aria-hidden="false">
          <h3 class="agf-section-title">Sélectionnez les fichiers</h3>
          <div id="agfDropzone" class="agf-dropzone" role="button" tabindex="0" aria-label="Zone de dépôt fichiers">
            <h4>Cliquez ou glissez-déposez des fichiers</h4>
            <p>PDF, Word, Excel, images et autres formats courants (10 Mo max / fichier).</p>
            <p class="agf-formats-explicit">Formats pris en charge : CSV, Word (doc, docx), PowerPoint (ppt, pptx), Excel (xls, xlsx), TXT.</p>
          </div>
          <input id="agfFileInput" type="file" name="fileUpload[]" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.ppt,.pptx,.txt,.json,.fec,.png,.jpg,.jpeg,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/csv,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,application/json,image/png,image/jpeg">

          <h3 class="agf-section-title">Fichiers à anonymiser</h3>
          <div id="agfFileList" class="agf-list" role="list"></div>

          <div id="agfStatus" class="agf-status" role="status" aria-live="polite"></div>

          <div class="agf-actions">
            <button id="agfSubmit" type="submit" class="agf-btn-primary" disabled>Anonymiser les fichiers</button>
            <button id="agfReset" type="button" class="agf-btn-secondary">Effacer</button>
            <a id="agfDownload" href="#" class="agf-download" download>Télécharger le résultat</a>
          </div>
        </section>

        <section id="agfPanel-text" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-text" aria-hidden="true">
          <div class="agf-row agf-row--text">
            <div class="agf-textbox agf-textbox--flex">
              <div class="agf-textbox-head">
                <label for="agfInputText">Saisissez le texte</label>
                <button id="agfTextClear" type="button" class="agf-btn-link agf-btn-link--small" aria-label="Effacer le texte"><span class="agf-icon-trash" aria-hidden="true"></span>Effacer le texte</button>
              </div>
              <div class="agf-textbox-body">
                <textarea id="agfInputText" class="agf-textarea" placeholder="Tapez ou collez votre texte ici..."></textarea>
              </div>
            </div>
            <div class="agf-textbox agf-textbox--flex">
              <label class="agf-textbox-label">Texte traité</label>
              <div class="agf-output-wrap" id="agfOutputWrap">
                <button id="agfTextCopy" type="button" class="agf-output-copy" aria-label="Copier"><span class="agf-icon-copy" aria-hidden="true"></span>Copier</button>
                <div id="agfOutputText" class="agf-text-output" role="region" aria-live="polite">Le texte traité apparaîtra ici</div>
                <div id="agfOutputStats" class="agf-output-stats" aria-live="polite">
                  <p id="agfOutputSummary" class="agf-output-summary">Aucun champ anonymisé détecté pour l'instant.</p>
                  <div id="agfOutputEntities" class="agf-output-entities"></div>
                </div>
              </div>
            </div>
          </div>
          <p class="agf-small">Traitement automatique à la saisie (sans bouton).</p>
        </section>


        <section id="agfPanel-restore" class="agf-panel" role="tabpanel" aria-labelledby="agfTab-restore" aria-hidden="true">
          <div class="agf-lock-block" id="agfRestoreLocked">
            <svg class="agf-lock-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="3" y="11" width="18" height="10" rx="2" stroke="currentColor" stroke-width="1.6"/>
              <path d="M7 11V8a5 5 0 0110 0v3" stroke="currentColor" stroke-width="1.6"/>
              <circle cx="12" cy="16" r="1.2" fill="currentColor"/>
            </svg>
            <p class="agf-lock-title">Restauration des pseudonymes</p>
            <p class="agf-lock-text">Module de restauration prêt côté interface. L'activation backend sera branchée dès validation du mapping sécurisé.</p>
            <button id="agfUpgradeRestore" type="button" class="agf-btn-primary">Préparer la gouvernance</button>
          </div>
        </section>
      </div>

      <aside class="agf-side" aria-label="Paramètres">
        <div class="agf-group agf-manual-auth is-collapsed" id="agfManualAuth">
          <p class="agf-label">Connexion API</p>
          <button type="button" class="agf-manual-auth-toggle" id="agfManualAuthToggle" aria-expanded="false" aria-controls="agfManualAuthFields">Utiliser des identifiants manuels</button>
          <div class="agf-manual-auth-fields" id="agfManualAuthFields" aria-hidden="true">
            <label for="agfManualUsername">Username (email)</label>
            <input type="text" id="agfManualUsername" name="agfManualUsername" placeholder="email@exemple.com" autocomplete="username">
            <label for="agfManualToken">Token</label>
            <input type="text" id="agfManualToken" name="agfManualToken" placeholder="Token API" autocomplete="off">
            <label for="agfManualEdition">Edition</label>
            <select id="agfManualEdition" name="agfManualEdition">
              <option value="free">free</option>
              <option value="pro">pro</option>
              <option value="ent">ent</option>
              <option value="anonymisation">anonymisation</option>
            </select>
          </div>
        </div>

        <div class="agf-group">
          <p class="agf-label">Mode de traitement</p>
          <label class="agf-radio-line"><input type="radio" name="agfMode" value="anonymiser" checked> Anonymiser</label>
          <button id="agfPseudoMode" type="button" class="agf-item-btn"><span>Pseudonymiser</span><span class="agf-chip" id="agfPseudoBadge">Paramétrer</span></button>
        </div>

        <div class="agf-group">
          <p class="agf-label">Paramètres</p>
          <button id="agfOpenTypes" type="button" class="agf-item-btn agf-item-btn--count">
            <span>Types de données</span>
            <span class="agf-chip-count" id="agfTypesCount">17</span>
          </button>
          <button id="agfOpenInclusion" type="button" class="agf-item-btn"><span>Inclusion / Exclusion</span><span id="agfInclusionChip" class="agf-chip">0 / 0</span></button>
        </div>

        <div class="agf-group">
          <p class="agf-label">Enregistré</p>
          <button id="agfPseudoSaved" type="button" class="agf-item-btn"><span>Pseudonymes</span><span class="agf-chip">Gérer</span></button>
          <p id="agfPseudoSummary" class="agf-small">Pseudo: configuration standard</p>
          <p id="agfSavedTypesInfo" class="agf-small">Types actifs: 0</p>
          <p id="agfLastMaskInfo" class="agf-small">Champs anonymisés (texte): 0</p>
        </div>

        <p id="agfApiMeta" class="agf-small">API: vérification...</p>
        <p class="agf-small"><a href="https://api.agilotext.com/html/menu.html" target="_blank" rel="noopener noreferrer" id="agfApiLink">API Agilotext</a></p>
      </aside>
    </div>
  </section>
</form>

<div id="agfModalTypesWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalTypesTitle" aria-hidden="true">
  <div class="agf-modal">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalTypesTitle" class="agf-modal-title">Sélectionnez les types de données</h3>
        <p class="agf-modal-subtitle">Ces préférences sont enregistrées et appliquées aux prochains traitements.</p>
      </div>
      <button id="agfModalTypesClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-type-grid" id="agfTypeGrid">
      <section class="agf-type-card" data-type-group="person">
        <div class="agf-type-card-head">
          <h5>Données personnelles</h5>
          <span class="agf-type-card-count" id="agfGroupCount-person">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="PR" data-api="person_name" checked><span class="agf-entity-code">PR</span><span class="agf-entity-name">Nom de personne</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="MAIL" data-api="email" checked><span class="agf-entity-code">MAIL</span><span class="agf-entity-name">Adresse email</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="PHON" data-api="phone" checked><span class="agf-entity-code">PHON</span><span class="agf-entity-name">Téléphone</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="AGE" data-api="birth" checked><span class="agf-entity-code">AGE</span><span class="agf-entity-name">Âge / naissance</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="TR" data-api="role" checked><span class="agf-entity-code">TR</span><span class="agf-entity-name">Titre / profession</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="DT" data-api="" checked><span class="agf-entity-code">DT</span><span class="agf-entity-name">Date et heure</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="company">
        <div class="agf-type-card-head">
          <h5>Données d'entreprise</h5>
          <span class="agf-type-card-count" id="agfGroupCount-company">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="CIE" data-api="company" checked><span class="agf-entity-code">CIE</span><span class="agf-entity-name">Nom d'entreprise</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CID" data-api="siren" checked><span class="agf-entity-code">CID</span><span class="agf-entity-name">Identifiant administratif</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="ACT" data-api="accounting" checked><span class="agf-entity-code">ACT</span><span class="agf-entity-name">Entrée comptable</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="PROD" data-api="product" checked><span class="agf-entity-code">PROD</span><span class="agf-entity-name">Produit / service</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="ORG" data-api="company" checked><span class="agf-entity-code">ORG</span><span class="agf-entity-name">Organisation</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FILE" data-api=""><span class="agf-entity-code">FILE</span><span class="agf-entity-name">Nom de dossier</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="location">
        <div class="agf-type-card-head">
          <h5>Données de localisation</h5>
          <span class="agf-type-card-count" id="agfGroupCount-location">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="ADR" data-api="address" checked><span class="agf-entity-code">ADR</span><span class="agf-entity-name">Adresse</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="POST" data-api="address" checked><span class="agf-entity-code">POST</span><span class="agf-entity-name">Code postal</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="LOC" data-api="address" checked><span class="agf-entity-code">LOC</span><span class="agf-entity-name">Ville / région</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="GEO" data-api=""><span class="agf-entity-code">GEO</span><span class="agf-entity-name">Géolocalisation</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="finance">
        <div class="agf-type-card-head">
          <h5>Données financières</h5>
          <span class="agf-type-card-count" id="agfGroupCount-finance">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option"><input type="checkbox" data-entity="BANK" data-api="bank" checked><span class="agf-entity-code">BANK</span><span class="agf-entity-name">Compte bancaire</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CARD" data-api="bank" checked><span class="agf-entity-code">CARD</span><span class="agf-entity-name">Carte bancaire</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="REF" data-api="contract" checked><span class="agf-entity-code">REF</span><span class="agf-entity-name">Numéro de référence</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="MT" data-api=""><span class="agf-entity-code">MT</span><span class="agf-entity-name">Montant</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="IBAN" data-api=""><span class="agf-entity-code">IBAN</span><span class="agf-entity-name">IBAN</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="misc">
        <div class="agf-type-card-head">
          <h5>Données diverses</h5>
          <span class="agf-type-card-count" id="agfGroupCount-misc">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="URL" data-api=""><span class="agf-entity-code">URL</span><span class="agf-entity-name">URL</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="IP" data-api=""><span class="agf-entity-code">IP</span><span class="agf-entity-name">Adresse IP</span></label>
          <label class="agf-entity-option"><input type="checkbox" data-entity="CLAUSE" data-api="contract"><span class="agf-entity-code">CLAUSE</span><span class="agf-entity-name">Clause sensible</span></label>
        </div>
      </section>

      <section class="agf-type-card" data-type-group="france">
        <div class="agf-type-card-head">
          <h5>Formats spécifiques France</h5>
          <span class="agf-type-card-count" id="agfGroupCount-france">0</span>
        </div>
        <div class="agf-checkboxes">
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRNIR" data-api=""><span class="agf-entity-code">FRNIR</span><span class="agf-entity-name">NIR</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRPASS" data-api=""><span class="agf-entity-code">FRPASS</span><span class="agf-entity-name">Passeport</span></label>
          <label class="agf-entity-option is-future"><input type="checkbox" data-entity="FRCNI" data-api=""><span class="agf-entity-code">FRCNI</span><span class="agf-entity-name">Carte d'identité</span></label>
        </div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <div class="agf-actions">
        <button id="agfDefaultsTypes" type="button" class="agf-btn-secondary">Paramètres par défaut</button>
        <button id="agfDetectAllTypes" type="button" class="agf-btn-link">Tout détecter</button>
        <button id="agfIgnoreAllTypes" type="button" class="agf-btn-link">Tout ignorer</button>
      </div>
      <button id="agfSaveTypes" type="button" class="agf-btn-primary">Enregistrer</button>
    </div>
  </div>
</div>

<div id="agfModalPseudoWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalPseudoTitle" aria-hidden="true">
  <div class="agf-modal agf-modal--wide">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalPseudoTitle" class="agf-modal-title">Pseudonymisation pilotée</h3>
        <p class="agf-modal-subtitle">Définissez une politique robuste de pseudonymisation. L'interface est prête et les paramètres seront appliqués sans rupture lors de l'activation backend.</p>
      </div>
      <button id="agfModalPseudoClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-pseudo-grid">
      <section class="agf-pseudo-card">
        <p class="agf-pseudo-title">Stratégie de remplacement</p>
        <p class="agf-pseudo-desc">Détermine le format des valeurs pseudonymisées dans les résultats et exports.</p>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyPlaceholders" type="radio" name="agfPseudoStrategy" value="placeholders" checked>
          <label for="agfPseudoStrategyPlaceholders">Identifiants lisibles (ex: [PR-0001])</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyStable" type="radio" name="agfPseudoStrategy" value="stable_hash">
          <label for="agfPseudoStrategyStable">Jeton stable (hash cohérent)</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoStrategyAlias" type="radio" name="agfPseudoStrategy" value="human_alias">
          <label for="agfPseudoStrategyAlias">Alias métier (lecture humaine contrôlée)</label>
        </div>
        <div class="agf-select-line">
          <label for="agfPseudoScope">Périmètre de cohérence</label>
          <select id="agfPseudoScope">
            <option value="document">Document</option>
            <option value="batch">Lot de fichiers</option>
            <option value="workspace">Espace client</option>
          </select>
        </div>
      </section>

      <section class="agf-pseudo-card">
        <p class="agf-pseudo-title">Sécurité et restauration</p>
        <p class="agf-pseudo-desc">Définit la gouvernance de clé et la politique de restauration.</p>
        <div class="agf-select-line">
          <label for="agfPseudoKeyMode">Gestion de clé</label>
          <select id="agfPseudoKeyMode">
            <option value="server">Clé serveur managée</option>
            <option value="client">Clé client (BYOK)</option>
            <option value="hsm">HSM / KMS dédié</option>
          </select>
        </div>
        <div class="agf-select-line">
          <label for="agfPseudoRestoreWindow">Fenêtre de restauration</label>
          <select id="agfPseudoRestoreWindow">
            <option value="24h">24 heures</option>
            <option value="7d">7 jours</option>
            <option value="30d" selected>30 jours</option>
            <option value="never">Aucune restauration</option>
          </select>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoDeterministic" type="checkbox" checked>
          <label for="agfPseudoDeterministic">Même donnée source -> même pseudonyme</label>
        </div>
        <div class="agf-option-line">
          <input id="agfPseudoPreserveFormat" type="checkbox" checked>
          <label for="agfPseudoPreserveFormat">Préserver la structure (longueur, séparateurs)</label>
        </div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <button id="agfPseudoDefaults" type="button" class="agf-btn-secondary">Réinitialiser</button>
      <button id="agfSavePseudo" type="button" class="agf-btn-primary">Enregistrer la politique</button>
    </div>
  </div>
</div>

<div id="agfModalInclusionWrap" class="agf-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agfModalIncTitle" aria-hidden="true">
  <div class="agf-modal agf-modal--wide">
    <div class="agf-modal-head">
      <div>
        <h3 id="agfModalIncTitle" class="agf-modal-title">Inclusion / Exclusion</h3>
        <p class="agf-modal-subtitle">Gérez les listes d'inclusion et d'exclusion pour réduire les faux positifs et faux négatifs. La comparaison ignore la casse et les accents.</p>
      </div>
      <button id="agfModalIncClose" type="button" class="agf-close" aria-label="Fermer">&times;</button>
    </div>

    <div class="agf-inc-grid">
      <section class="agf-inc-card agf-inc-card--include">
        <h4>Liste d'inclusion</h4>
        <p>Ces termes sont toujours détectés et anonymisés, même hors des types sélectionnés.</p>
        <div class="agf-inc-add">
          <input id="agfIncludeInput" type="text" placeholder="Ajouter un terme à inclure...">
          <button id="agfIncludeAdd" type="button">Ajouter</button>
        </div>
        <div id="agfIncludeList" class="agf-term-list" aria-live="polite"></div>
      </section>

      <section class="agf-inc-card agf-inc-card--exclude">
        <h4>Liste d'exclusion</h4>
        <p>Ces termes sont systématiquement ignorés lors de l'anonymisation, même s'ils correspondent aux types sélectionnés.</p>
        <div class="agf-inc-add">
          <input id="agfExcludeInput" type="text" placeholder="Ajouter un terme à exclure...">
          <button id="agfExcludeAdd" type="button">Ajouter</button>
        </div>
        <div id="agfExcludeList" class="agf-term-list" aria-live="polite"></div>
      </section>
    </div>

    <div class="agf-modal-actions">
      <span id="agfIncSummary" class="agf-small">Inclusion: 0 · Exclusion: 0</span>
      <div class="agf-actions">
        <button id="agfInclusionDefaults" type="button" class="agf-btn-secondary">Vider les listes</button>
        <button id="agfSaveInclusion" type="button" class="agf-btn-primary">Enregistrer les listes</button>
      </div>
    </div>

    <textarea id="agfIncludeTerms" class="agf-hidden-field" aria-hidden="true"></textarea>
    <textarea id="agfExcludeTerms" class="agf-hidden-field" aria-hidden="true"></textarea>
  </div>
</div>
